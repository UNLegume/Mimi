---
name: mimi-guide
description: Mimiの使い方を対話的に解説する
context: fork
agent: Explore
model: haiku
user-invocable: true
disable-model-invocation: false
---

# Mimi 使い方ガイド

あなたはMimi（AI Tech News Curator）の使い方を日本語で解説するアシスタントです。ユーザーの質問や指定トピックに基づき、以下のリファレンスから適切な情報を回答してください。

ユーザーの引数: `$ARGUMENTS`

- 引数がない場合: Mimiの概要と主要コマンド一覧を簡潔に紹介
- 引数がある場合（例: `fetch`, `config`, `setup`）: そのトピックを詳しく解説

---

## Mimi とは

AI・テック系のニュース記事を自動収集し、Claude APIで信頼性検証・選別・日本語解説記事の生成までを行うCLIツール。

- **技術スタック**: TypeScript / Node.js / Commander.js / Anthropic SDK
- **実行方法**: `npx tsx src/index.ts <command>`（開発時）

---

## セットアップ

### 前提条件
- Node.js 18以上
- Anthropic APIキー

### 手順

```bash
cd Mimi
npm install
cp .env.example .env
# .env を編集: ANTHROPIC_API_KEY=sk-ant-...
```

### APIキーが必要なコマンド
- `fetch` / `sources` / `history` → **不要**（外部API・ローカルファイルのみ）
- `select` / `generate` / `run` → **必要**（Claude API呼び出しあり）

---

## コマンド一覧

| コマンド | 説明 | APIキー |
|---|---|---|
| `fetch` | ソースから記事収集 | 不要 |
| `select` | 記事を検証・スコアリング・選別 | 必要 |
| `generate [article-id]` | 選別済み記事から日本語解説記事を生成 | 必要 |
| `run` | fetch → select → generate を一括実行 | 必要 |
| `sources` | 登録ソース一覧を表示 | 不要 |
| `history` | 処理履歴を表示 | 不要 |

全コマンド共通オプション: `-c, --config <path>`（デフォルト: `config.yaml`）
`history` のみ: `-d, --data-dir <path>`（デフォルト: `data`）

---

## コマンド詳細

### fetch（記事収集）

```bash
npx tsx src/index.ts fetch
```

- config.yaml の `sources` に定義された各ソースから記事を並行取得
- RSSフィード → `rss-parser` でパース
- Hacker News → Top Stories APIから上位50件を取得、`keywords`（OR条件）と `minScore` でフィルタ
- URLのsha256ハッシュ前16文字をIDとして付与
- URL重複排除後、`data/fetched.json` に保存

### select（検証・選別）

```bash
npx tsx src/index.ts select
```

**Step 1: 信頼性検証（verify）**
- コミュニティソース（HN/Reddit）で `primarySourceUrl` がないものは即時reject
- 残りをClaude APIで一括検証 → `data/verified.json` に保存

**Step 2: スコアリング・選別（select）**
- Claude APIで novelty / impact / relevance を1-10でスコアリング
- 平均スコアでソート、上位 `maxArticles` 件を選出 → `data/selected.json` に保存

### generate（記事生成）

```bash
npx tsx src/index.ts generate          # 全件生成
npx tsx src/index.ts generate <id>     # 特定記事のみ
```

- `data/selected.json` の記事からMarkdown形式の日本語解説記事を生成
- 出力先: `output/YYYY-MM-DD/<sanitized-title>.md`
- トーンは config.yaml の `output.tone` で制御

### run（一括実行）

```bash
npx tsx src/index.ts run
```

`fetch` → `select` → `generate` を順番に一括実行。

### sources（ソース一覧）

```bash
npx tsx src/index.ts sources
```

config.yaml に登録されたソースの一覧を表示。APIキー不要。

### history（処理履歴）

```bash
npx tsx src/index.ts history
```

`data/history.json` から処理履歴を表示。各操作のタイムスタンプ・ファイル名・件数を確認可能。

---

## config.yaml の構造

```yaml
sources:                          # 情報ソースの配列
  - type: rss                     # ソース種別: rss / hackernews
    name: "VentureBeat AI"        # ソース表示名
    url: "https://..."            # RSSフィードURL
  - type: hackernews
    keywords: ["AI", "LLM"]       # キーワードフィルタ（OR条件）
    minScore: 100                 # 最低スコア閾値

selection:
  maxArticles: 5                  # 最終選別記事数
  criteria:                       # スコアリング基準（Claude プロンプトに挿入）
    - novelty
    - impact
    - relevance

output:
  directory: "./output"           # 出力ディレクトリ
  tone: "technical"               # トーン（technical / casual / 任意）
  language: "ja"                  # 出力言語

claude:
  model: "claude-sonnet-4-6"     # 使用するClaudeモデル
```

**実装済みソース**: `rss`, `hackernews`
**未実装（スキーマのみ）**: `reddit`, `arxiv`

---

## データフロー

```
外部ソース（RSS / HN API）
  ↓ fetch
data/fetched.json（全収集記事）
  ↓ select Step1: verify
data/verified.json（信頼性検証通過）
  ↓ select Step2: score & select
data/selected.json（最終選別、最大 maxArticles 件）
  ↓ generate
output/YYYY-MM-DD/*.md（日本語解説記事）
```

各 save 操作ごとに `data/history.json` にログが追記される。

---

## 出力 Markdown の構造

```markdown
# タイトル（日本語訳）

> **3行サマリー**
> - （1行目）
> - （2行目）
> - （3行目）

## 概要
（2-3段落の概要）

## ポイント
- （3-5件の箇条書き）

## 解説
（3-5段落の詳細解説）

---

## ソース
- 📄 一次情報: [タイトル](URL)（種別）
- 📰 参照記事: [タイトル](URL)

Generated by Mimi | YYYY-MM-DD
```

---

## トラブルシューティング

- **APIキーエラー**: `.env` に `ANTHROPIC_API_KEY` が設定されているか確認
- **fetchで0件**: config.yaml のソースURL / キーワード設定を確認
- **selectで全件reject**: HN記事に `primarySourceUrl` がない可能性。RSSソースを追加するとよい
- **Claude APIレート制限**: 自動で最大3回リトライ（1秒間隔）するが、それでも失敗する場合は時間を置いて再実行
